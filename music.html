<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><!-- 复制粘贴您完整的 HTML -->
<!-- 确保里面没有 Hexo 模板语法 -->
<!DOCTYPE html>
<html lang="zh-CN" w-tid="1">
  <head w-tid="3">
    <title>Hi There!</title>
    <meta property="og:title" content="Hi There!" />

<pre><code>&lt;meta charset=&quot;UTF-8&quot; w-tid=&quot;5&quot; /&gt;
&lt;meta
  name=&quot;viewport&quot;
  content=&quot;width=device-width, initial-scale=1.0&quot;
  w-tid=&quot;7&quot;
/&gt;
&lt;!--title&gt;云音乐 - 在线音乐播放器&lt;/title--&gt;
&lt;link
  href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;
  rel=&quot;stylesheet&quot;
  w-tid=&quot;11&quot;
/&gt;
&lt;style w-tid=&quot;13&quot;&gt;
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
      &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;
    background: #0c0c0c;
    color: #fff;
    overflow-x: hidden;
  }

  /* 背景动画 */
  .bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    z-index: -2;
  }

  .bg-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px);
    z-index: -1;
  }

  @keyframes gradientBG {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* 顶部导航 */
  .navbar {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 15px 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    flex-shrink: 0; /* 防止logo被压缩 */
  }

  .logo i {
    color: #ff6b6b;
    font-size: 28px;
  }

  .search-container {
    flex: 1;
    max-width: 600px;
    margin: 0 40px;
    position: relative;
  }

  .search-wrapper {
    display: flex;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 25px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    width: 100%;
    box-sizing: border-box;
  }

  .search-wrapper:focus-within {
    background: rgba(255, 255, 255, 0.2);
    border-color: #ff6b6b;
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
  }

  .search-input {
    flex: 1;
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: #fff;
    font-size: 16px;
    outline: none;
    min-width: 0; /* 允许输入框收缩 */
  }

  .search-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }

  .source-select {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #fff;
    padding: 12px 15px;
    outline: none;
    cursor: pointer;
    display: none; /* 默认隐藏，移动端显示 */
  }

  .source-select option {
    background: #2a2a2a;
    color: #fff;
    padding: 8px;
  }

  .search-btn {
    background: #ff6b6b;
    border: none;
    color: #fff;
    padding: 12px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 50px; /* 确保按钮不会太小 */
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .search-btn:hover {
    background: #ff5252;
  }

  /* 主要内容区域 - 关键修复：添加容器宽度控制 */
  .main-container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 30px;
    display: grid;
    grid-template-columns: 600px 600px;
    gap: 25px;
    min-height: calc(100vh - 200px);
    align-items: stretch;
    /* 关键修复：防止子元素影响容器宽度 */
    width: 100%;
    box-sizing: border-box;
    justify-content: center;
  }

  /* 搜索结果区域 */
  .content-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-width: 0;
    overflow: hidden;
    /* 关键修复：防止内容溢出影响布局 */
    max-width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .section-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 10px;
    /* 确保子元素不会被压缩 */
    flex-wrap: nowrap;
  }

  .playlist-tag-indicator {
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 600;
    color: #ffffff;
    padding: 2px 12px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  #resultsTitle {
    background: linear-gradient(90deg, #ff6b6b, #ff8a80);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
    position: relative;
    padding: 2px 4px;
    transition: all 0.3s ease;
  }

  .search-results {
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    /* 关键修复：设置高度限制，与播放器区域对齐 */
    height: calc(100vh - 240px);
    min-height: 400px;
  }

  .search-results::-webkit-scrollbar {
    width: 6px;
  }

  .search-results::-webkit-scrollbar-track {
    background: transparent;
  }

  .search-results::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
  }

  .song-item {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 8px;
    position: relative;
    overflow: hidden;
    /* 关键修复：防止内容溢出 */
    max-width: 100%;
  }

  .song-item::before {
    content: &quot;&quot;;
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      transparent
    );
    transition: left 0.5s ease;
  }

  .song-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }

  .song-item:hover::before {
    left: 100%;
  }

  .song-item.active {
    background: linear-gradient(
      135deg,
      rgba(255, 107, 107, 0.3),
      rgba(255, 107, 107, 0.1)
    );
    border: 1px solid rgba(255, 107, 107, 0.5);
  }

  .song-index {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 14px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.7);
    flex-shrink: 0; /* 防止被压缩 */
  }

  .song-item.active .song-index {
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    color: #fff;
  }

  .song-info {
    flex: 1;
    min-width: 0; /* 允许收缩 */
  }

  .song-name {
    font-weight: 600;
    margin-bottom: 5px;
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .song-artist {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* 播放器区域 */
  .player-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    height: fit-content;
    min-height: calc(100vh - 240px);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    /* 关键修复：防止内容溢出影响布局 */
    max-width: 100%;
    box-sizing: border-box;
  }

  /* 播放器歌词显示 - 关键修复：完全控制宽度 */
  .player-lyrics-container {
    margin: 20px 0;
    height: 150px;
    position: relative;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 10px;
    backdrop-filter: blur(5px);
    /* 关键修复：固定宽度并防止溢出 */
    width: 100%;
    box-sizing: border-box;
    flex-shrink: 0;
    /* 防止内容溢出 */
    overflow: hidden;
  }

  .player-lyrics-wrapper {
    position: relative;
    height: 100%;
    overflow-y: auto;
    display: block;
    /* 关键修复：隐藏滚动条但保持功能 */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
    /* 防止内容溢出 */
    overflow-x: hidden;
  }

  /* 隐藏webkit滚动条 */
  .player-lyrics-wrapper::-webkit-scrollbar {
    display: none;
  }

  .player-lyrics-list {
    position: relative;
    width: 100%;
    /* 关键修复：防止列表宽度受内容影响 */
    table-layout: fixed;
  }

  .player-lyric-line {
    height: 30px;
    line-height: 30px;
    text-align: center;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.4);
    transition: all 0.3s ease;
    padding: 0 20px;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    cursor: pointer;
    /* 关键修复：确保行宽度固定，防止溢出 */
    width: 100%;
    box-sizing: border-box;
    /* 防止长文本影响布局 */
    max-width: 100%;
    /* 确保文本不会因为放大而溢出 */
    transform-origin: center;
    /* 调整行间距 */
    margin: 3px 0;
  }

  .player-lyric-line.long-text {
    font-size: 12px;
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.3;
    height: auto;
    min-height: 20px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    text-overflow: clip;
    /* 限制最大宽度 */
    max-width: 100%;
    /* 调整行间距 */
    margin: 3px 0;
  }

  .player-lyric-line.current {
    color: rgba(255, 255, 255, 0.9);
    font-weight: bold;
    /* 移除字号放大以避免宽度问题 */
    font-size: 14px;
    /* 增加与上下歌词的间距 */
    margin: 6px 0;
  }

  .player-lyric-line.current.long-text {
    font-size: 14px;
    /* 增加与上下歌词的间距 */
    margin: 6px 0;
  }

  .player-lyric-line.before-current,
  .player-lyric-line.after-current {
    color: rgba(255, 255, 255, 0.6);
  }

  /* 模糊效果 */
  .player-lyric-line.first,
  .player-lyric-line.last {
    color: rgba(255, 255, 255, 0.3);
    filter: blur(1px);
  }

  /* 歌词校准控制 */
  .lyrics-adjust-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  /* .player-lyrics-container:hover .lyrics-adjust-controls {
        opacity: 1;
    } */

  /* 偏移量显示 */
  .lyrics-offset-display {
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    background: rgba(0, 0, 0, 0.3);
    padding: 2px 6px;
    border-radius: 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .player-lyrics-container:hover .lyrics-offset-display {
    opacity: 1;
  }

  .lyrics-adjust-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 5px;
    color: rgba(255, 255, 255, 0.7);
    padding: 5px 10px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  }

  .lyrics-adjust-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #fff;
  }

  .current-song {
    text-align: center;
    /* margin-bottom: 25px; */
  }

  .current-cover-container {
    position: relative;
    display: inline-block;
    margin-bottom: 20px;
  }

  .current-cover {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
    border: 6px solid rgba(255, 255, 255, 0.1);
    position: relative;
  }

  .current-cover::before {
    content: &quot;&quot;;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    backdrop-filter: blur(10px);
  }

  .current-cover::after {
    content: &quot;&quot;;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 12px;
    height: 12px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
  }

  .current-cover.playing {
    animation: rotate 20s linear infinite;
  }

  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .current-info h3 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #fff;
    /* 防止标题过长 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .current-info p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 16px;
    /* 防止艺术家信息过长 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* 播放控制 */
  .player-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin: 20px 0;
  }

  .control-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  .control-btn.small {
    width: 45px;
    height: 45px;
    font-size: 18px;
  }

  .play-btn {
    width: 65px;
    height: 65px;
    font-size: 28px;
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .play-btn:hover {
    background: linear-gradient(135deg, #ff5252, #ff4444);
    box-shadow: 0 12px 35px rgba(255, 107, 107, 0.6);
  }

  /* 进度条 */
  .progress-container {
    margin-bottom: 20px;
  }

  .progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #ff8a80);
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s ease;
    position: relative;
  }

  .progress-fill::after {
    content: &quot;&quot;;
    position: absolute;
    right: -2px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .time-info {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
  }

  /* 音量控制 */
  .volume-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 25px;
  }

  .volume-icon {
    color: rgba(255, 255, 255, 0.7);
    font-size: 18px;
    flex-shrink: 0; /* 防止图标被压缩 */
  }

  .volume-slider {
    flex: 1;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
    -webkit-appearance: none;
  }

  .volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: #ff6b6b;
    border-radius: 50%;
    cursor: pointer;
  }

  /* 音质选择 */
  .quality-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .quality-label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    flex-shrink: 0; /* 防止标签被压缩 */
  }

  .quality-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: #fff;
    padding: 8px 12px;
    outline: none;
    cursor: pointer;
    font-size: 14px;
    /* 防止选择框过宽 */
    max-width: 150px;
  }

  .quality-select option {
    background: #2a2a2a;
    color: #fff;
    padding: 8px;
  }

  /* 下载区域 */
  .download-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
  }

  .download-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    /* 防止按钮内容过宽 */
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .download-btn:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
    border-color: #ff6b6b;
    color: #ff6b6b;
  }

  .download-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* 歌曲操作按钮 */
  .song-actions {
    display: flex;
    gap: 8px;
    margin-right: 15px;
    flex-shrink: 0; /* 防止按钮组被压缩 */
  }

  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .action-btn:hover {
    background: rgba(255, 107, 107, 0.3);
    color: #ff6b6b;
    transform: scale(1.1);
  }

  /* 歌词容器 */
  .lyrics-container {
    flex: 1;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    padding-right: 10px;
  }

  .lyrics-container::-webkit-scrollbar {
    width: 6px;
  }

  .lyrics-container::-webkit-scrollbar-track {
    background: transparent;
  }

  .lyrics-container::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
  }

  .lyric-line {
    padding: 8px 0;
    transition: all 0.3s ease;
    cursor: pointer;
    border-radius: 6px;
    padding-left: 10px;
    margin-bottom: 4px;
    color: rgba(255, 255, 255, 0.6);
    line-height: 1.6;
    /* 防止歌词过长 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lyric-line:hover {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.8);
  }

  .lyric-line.active {
    color: #ff6b6b;
    font-weight: 600;
    background: rgba(255, 107, 107, 0.1);
    transform: scale(1.02);
    border-left: 3px solid #ff6b6b;
  }

  /* 歌单导入区域 */
  .playlist-import {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 20px;
  }

  /* 歌单详情 */
  .playlist-detail {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 20px;
    display: none;
  }

  .playlist-header {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }

  .playlist-cover {
    width: 150px;
    height: 150px;
    border-radius: 10px;
    object-fit: cover;
    flex-shrink: 0; /* 防止图片被压缩 */
  }

  .playlist-info-container {
    flex: 1;
    min-width: 0; /* 允许收缩 */
  }

  .playlist-title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
    /* 允许标题换行以避免被截断 */
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.3;
    /* 限制最大行数 */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .playlist-creator {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .creator-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0; /* 防止头像被压缩 */
  }

  .creator-name {
    font-weight: 500;
    /* 防止名字过长 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .playlist-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
  }

  .playlist-description {
    margin-bottom: 15px;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.9);
    /* 允许描述换行显示 */
    white-space: normal;
    word-wrap: break-word;
    /* 限制最大行数 */
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .playlist-tags {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .playlist-tag {
    background: rgba(255, 107, 107, 0.2);
    color: #ff6b6b;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    /* 防止标签过长 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .import-form {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }

  .import-input {
    flex: 1;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: #fff;
    outline: none;
    font-size: 14px;
    /* 防止输入框过宽 */
    min-width: 0;
  }

  .import-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }

  .import-btn {
    padding: 12px 20px;
    background: #ff6b6b;
    border: none;
    border-radius: 10px;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .import-btn:hover {
    background: #ff5252;
  }

  .saved-playlists {
    margin-top: 20px;
  }

  .playlist-item {
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    /* 防止歌单项目过宽 */
    max-width: 100%;
  }

  .playlist-item:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .playlist-item .playlist-info {
    flex: 1;
    min-width: 0;
    margin-right: 10px;
  }

  .playlist-item .playlist-name {
    font-weight: 500;
    /* 允许歌单名称换行以避免挤出操作按钮 */
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.4;
    /* 限制最大行数 */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .playlist-item .playlist-count {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
    flex-shrink: 0; /* 防止计数被压缩 */
    /* 限制文本长度 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .playlist-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0; /* 防止按钮组被压缩 */
  }

  .playlist-action-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0; /* 防止按钮被压缩 */
  }

  .playlist-action-btn:hover {
    background: rgba(255, 107, 107, 0.3);
    color: #ff6b6b;
  }

  /* 加载和错误状态 */
  .loading,
  .error,
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: rgba(255, 255, 255, 0.7);
  }

  .loading i,
  .error i,
  .empty-state i {
    font-size: 48px;
    margin-bottom: 15px;
    display: block;
  }

  .loading i {
    animation: spin 1s linear infinite;
    color: #ff6b6b;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .error i {
    color: #ff5252;
  }

  .empty-state i {
    color: rgba(255, 255, 255, 0.4);
  }

  /* 响应式设计 */
  @media (max-width: 1400px) {
    .main-container {
      grid-template-columns: 1fr 400px;
      gap: 20px;
      max-width: 1200px;
    }
  }

  @media (max-width: 1024px) {
    .main-container {
      grid-template-columns: 1fr;
      gap: 20px;
      padding: 20px;
      /* 关键修复：确保容器不会因为内容而变宽 */
      width: 100%;
      max-width: 100%;
    }

    .nav-container {
      padding: 0 20px;
    }

    .search-container {
      margin: 0 20px;
    }

    .player-section {
      position: static;
      min-height: auto;
      height: auto;
    }

    /* 关键修复：确保所有子元素不会突破容器 */
    .content-section,
    .player-section {
      max-width: 100%;
      overflow: hidden;
    }
  }

  @media (max-width: 768px) {
    .nav-container {
      flex-direction: column;
      gap: 15px;
      padding: 0 15px;
    }

    .search-container {
      margin: 0;
      max-width: none;
      width: 100%;
      padding: 0;
    }

    .search-wrapper {
      width: 100%;
    }

    /* 在移动端显示来源选择 */
    .source-select {
      display: block;
    }

    /* 调整搜索按钮在移动端的显示 */
    .search-btn {
      padding: 12px 15px;
      min-width: 45px;
    }

    .search-btn i {
      font-size: 16px;
    }

    .current-cover {
      width: 180px;
      height: 180px;
    }

    .player-controls {
      gap: 15px;
    }

    .download-container {
      grid-template-columns: 1fr;
    }

    .import-form {
      flex-direction: column;
    }

    .import-btn {
      justify-content: center;
    }

    .playlist-header {
      flex-direction: column;
    }

    .playlist-cover {
      width: 100%;
      height: auto;
      aspect-ratio: 1/1;
    }

    /* 移动端歌词容器优化 */
    .player-lyrics-container {
      /* height: 120px; */
      padding: 8px;
      /* 关键修复：确保容器宽度固定 */
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    .player-lyric-line {
      font-size: 13px;
      height: 26px;
      line-height: 26px;
      padding: 0 10px;
      /* 防止文本溢出 */
      max-width: 100%;
      box-sizing: border-box;
      /* 调整行间距 */
      margin: 3px 0;
    }

    .player-lyric-line.current {
      /* 移除字号放大以避免宽度问题 */
      font-size: 13px;
      /* 增加与上下歌词的间距 */
      margin: 6px 0;
    }

    .player-lyric-line.long-text {
      font-size: 11px;
      /* 调整行间距 */
      margin: 3px 0;
    }

    .player-lyric-line.current.long-text {
      font-size: 13px;
      /* 增加与上下歌词的间距 */
      margin: 6px 0;
    }

    .playlist-tag-indicator {
      font-size: 12px;
      padding: 2px 10px;
      background: linear-gradient(135deg, #ff6b6b, #ff5252);
      color: #ffffff;
      /* 修复移动端显示问题 */
      white-space: nowrap;
      min-width: 0;
      flex-shrink: 0;
    }

    #resultsTitle {
      font-size: 20px;
      font-weight: 700;
    }

    #resultsTitle:not(:has(.playlist-tag-indicator)) {
      background: linear-gradient(90deg, #ff6b6b, #ff8a80);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  }

  /* 针对非常小的屏幕优化 */
  @media (max-width: 480px) {
    .nav-container {
      padding: 0 10px;
    }

    .logo {
      font-size: 20px;
    }

    .logo i {
      font-size: 24px;
    }

    .search-input {
      padding: 10px 15px;
      font-size: 14px;
    }

    .source-select {
      padding: 10px 10px;
      font-size: 14px;
    }

    .search-btn {
      padding: 10px 12px;
    }

    .content-section,
    .player-section,
    .playlist-import {
      padding: 20px 15px;
    }

    .song-item {
      padding: 12px 15px;
    }

    .song-name {
      font-size: 15px;
    }

    .song-artist {
      font-size: 13px;
    }

    .section-title {
      font-size: 18px;
      /* 确保子元素不会被压缩 */
      flex-wrap: nowrap;
    }

    .playlist-tag-indicator {
      font-size: 11px;
      padding: 1px 8px;
      background: linear-gradient(135deg, #ff6b6b, #ff5252);
      color: #ffffff;
      /* 修复小屏幕显示问题 */
      white-space: nowrap;
      min-width: 0;
      flex-shrink: 0;
    }

    #resultsTitle {
      font-size: 18px;
      font-weight: 700;
    }

    #resultsTitle:not(:has(.playlist-tag-indicator)) {
      background: linear-gradient(90deg, #ff6b6b, #ff8a80);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* 移动端歌单项目优化 */
    .playlist-item .playlist-name {
      font-size: 14px;
      line-height: 1.4;
    }

    .playlist-item .playlist-count {
      font-size: 12px;
    }

    /* 小屏幕歌词优化 */
    /* .player-lyrics-container {
            height: 100px;
        } */

    .player-lyric-line {
      font-size: 12px;
      height: 24px;
      line-height: 24px;
      /* 调整行间距 */
      margin: 3px 0;
    }

    .player-lyric-line.current {
      /* 移除字号放大以避免宽度问题 */
      font-size: 12px;
      /* 增加与上下歌词的间距 */
      margin: 6px 0;
    }
  }

  /* 自定义滚动条样式 */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
  }

  /* 滚动歌词样式 */
  .lyrics-container {
    max-height: 300px;
    overflow-y: auto;
  }

  .lyric-line.long-text {
    font-size: 12px;
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.4;
    padding: 4px 0;
  }
&lt;/style&gt;
</code></pre>
  </head>
  <body w-tid="15">
    <div class="bg-animation" w-tid="17"></div>
    <div class="bg-overlay" w-tid="19"></div>

<pre><code>&lt;!-- 顶部导航 --&gt;
&lt;nav class=&quot;navbar&quot; role=&quot;navigation&quot; aria-label=&quot;主导航&quot; w-tid=&quot;21&quot;&gt;
  &lt;div class=&quot;nav-container&quot; w-tid=&quot;23&quot;&gt;
    &lt;div class=&quot;logo&quot; role=&quot;banner&quot; w-tid=&quot;25&quot;&gt;
      &lt;i class=&quot;fas fa-music&quot; aria-hidden=&quot;true&quot; w-tid=&quot;27&quot;&gt;&lt;/i&gt;
      &lt;span w-tid=&quot;29&quot;&gt;云音乐&lt;/span&gt;
    &lt;/div&gt;

    &lt;div class=&quot;search-container&quot; w-tid=&quot;31&quot;&gt;
      &lt;div class=&quot;search-wrapper&quot; w-tid=&quot;33&quot;&gt;
        &lt;input
          type=&quot;text&quot;
          class=&quot;search-input&quot;
          placeholder=&quot;搜索音乐、歌手、专辑...&quot;
          id=&quot;searchInput&quot;
          aria-label=&quot;搜索音乐&quot;
          w-tid=&quot;35&quot;
        /&gt;
        &lt;select
          class=&quot;source-select&quot;
          id=&quot;sourceSelect&quot;
          aria-label=&quot;选择音乐来源&quot;
          w-tid=&quot;37&quot;
        &gt;
          &lt;option value=&quot;netease&quot; w-tid=&quot;39&quot;&gt;网易云音乐&lt;/option&gt;
          &lt;option value=&quot;tencent&quot; w-tid=&quot;41&quot;&gt;QQ音乐&lt;/option&gt;
          &lt;option value=&quot;kuwo&quot; w-tid=&quot;43&quot;&gt;酷我音乐&lt;/option&gt;
          &lt;option value=&quot;joox&quot; w-tid=&quot;45&quot;&gt;JOOX&lt;/option&gt;
          &lt;option value=&quot;kugou&quot; w-tid=&quot;47&quot;&gt;酷狗音乐&lt;/option&gt;
          &lt;option value=&quot;migu&quot; w-tid=&quot;49&quot;&gt;咪咕音乐&lt;/option&gt;
          &lt;option value=&quot;deezer&quot; w-tid=&quot;51&quot;&gt;Deezer&lt;/option&gt;
          &lt;option value=&quot;spotify&quot; w-tid=&quot;53&quot;&gt;Spotify&lt;/option&gt;
          &lt;option value=&quot;apple&quot; w-tid=&quot;55&quot;&gt;Apple Music&lt;/option&gt;
          &lt;option value=&quot;ytmusic&quot; w-tid=&quot;57&quot;&gt;YouTube Music&lt;/option&gt;
          &lt;option value=&quot;tidal&quot; w-tid=&quot;59&quot;&gt;TIDAL&lt;/option&gt;
          &lt;option value=&quot;qobuz&quot; w-tid=&quot;61&quot;&gt;Qobuz&lt;/option&gt;
          &lt;option value=&quot;ximalaya&quot; w-tid=&quot;63&quot;&gt;喜马拉雅&lt;/option&gt;
        &lt;/select&gt;
        &lt;button
          class=&quot;search-btn&quot;
          onclick=&quot;searchMusic()&quot;
          aria-label=&quot;搜索&quot;
          w-tid=&quot;65&quot;
        &gt;
          &lt;i class=&quot;fas fa-search&quot; aria-hidden=&quot;true&quot; w-tid=&quot;67&quot;&gt;&lt;/i&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

&lt;!-- 主要内容 --&gt;
&lt;div class=&quot;main-container&quot; w-tid=&quot;69&quot;&gt;
  &lt;!-- 搜索结果区域 --&gt;
  &lt;div class=&quot;content-section&quot; w-tid=&quot;71&quot;&gt;
    &lt;h2 class=&quot;section-title&quot; w-tid=&quot;73&quot;&gt;
      &lt;i class=&quot;fas fa-list-music&quot; w-tid=&quot;75&quot;&gt;&lt;/i&gt;
      &lt;span class=&quot;playlist-tag-indicator&quot; style=&quot;display: none&quot; w-tid=&quot;77&quot;
        &gt;歌单&lt;/span
      &gt;
      &lt;span id=&quot;resultsTitle&quot; w-tid=&quot;79&quot;&gt;搜索结果&lt;/span&gt;
      &lt;button
        id=&quot;clearPlaylistBtn&quot;
        class=&quot;action-btn&quot;
        style=&quot;margin-left: auto; display: none&quot;
        onclick=&quot;clearPlaylistView()&quot;
        title=&quot;清除歌单视图&quot;
        w-tid=&quot;81&quot;
      &gt;
        &lt;i class=&quot;fas fa-times&quot; w-tid=&quot;83&quot;&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/h2&gt;
    &lt;div class=&quot;search-results&quot; id=&quot;searchResults&quot; w-tid=&quot;85&quot;&gt;
      &lt;div class=&quot;empty-state&quot; w-tid=&quot;87&quot;&gt;
        &lt;i class=&quot;fas fa-search&quot; w-tid=&quot;89&quot;&gt;&lt;/i&gt;
        &lt;div w-tid=&quot;91&quot;&gt;在上方搜索框输入关键词开始搜索音乐&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 歌单详情区域 --&gt;
    &lt;div class=&quot;playlist-detail&quot; id=&quot;playlistDetail&quot; w-tid=&quot;93&quot;&gt;
      &lt;div class=&quot;playlist-header&quot; w-tid=&quot;95&quot;&gt;
        &lt;img
          class=&quot;playlist-cover&quot;
          id=&quot;playlistCover&quot;
          src
          alt=&quot;歌单封面&quot;
          w-tid=&quot;97&quot;
        /&gt;
        &lt;div class=&quot;playlist-info-container&quot; w-tid=&quot;99&quot;&gt;
          &lt;h2 class=&quot;playlist-title&quot; id=&quot;playlistTitle&quot; w-tid=&quot;101&quot;&gt;&lt;/h2&gt;
          &lt;div class=&quot;playlist-creator&quot; w-tid=&quot;103&quot;&gt;
            &lt;img
              class=&quot;creator-avatar&quot;
              id=&quot;creatorAvatar&quot;
              src
              alt=&quot;创建者头像&quot;
              w-tid=&quot;105&quot;
            /&gt;
            &lt;span class=&quot;creator-name&quot; id=&quot;creatorName&quot; w-tid=&quot;107&quot;&gt;&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class=&quot;playlist-stats&quot; w-tid=&quot;109&quot;&gt;
            &lt;span id=&quot;playlistPlayCount&quot; w-tid=&quot;111&quot;&gt;&lt;/span&gt;
            &lt;span id=&quot;playlistTrackCount&quot; w-tid=&quot;113&quot;&gt;&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class=&quot;playlist-tags&quot; id=&quot;playlistTags&quot; w-tid=&quot;115&quot;&gt;
            &lt;!-- 标签将在这里显示 --&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div
        class=&quot;playlist-description&quot;
        id=&quot;playlistDescription&quot;
        w-tid=&quot;117&quot;
      &gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 歌单导入区域 --&gt;
    &lt;div class=&quot;playlist-import&quot; w-tid=&quot;119&quot;&gt;
      &lt;h2 class=&quot;section-title&quot; w-tid=&quot;121&quot;&gt;
        &lt;i class=&quot;fas fa-folder-plus&quot; w-tid=&quot;123&quot;&gt;&lt;/i&gt;
        导入网易云歌单
      &lt;/h2&gt;
      &lt;div class=&quot;import-form&quot; w-tid=&quot;125&quot;&gt;
        &lt;input
          type=&quot;text&quot;
          class=&quot;import-input&quot;
          id=&quot;playlistIdInput&quot;
          placeholder=&quot;粘贴 ID 或 链接&quot;
          w-tid=&quot;127&quot;
        /&gt;
        &lt;button class=&quot;import-btn&quot; onclick=&quot;importPlaylist()&quot; w-tid=&quot;129&quot;&gt;
          &lt;i class=&quot;fas fa-download&quot; w-tid=&quot;131&quot;&gt;&lt;/i&gt;
          &lt;span w-tid=&quot;133&quot;&gt;导入&lt;/span&gt;
        &lt;/button&gt;
      &lt;/div&gt;
      &lt;div class=&quot;saved-playlists&quot; id=&quot;savedPlaylists&quot; w-tid=&quot;135&quot;&gt;
        &lt;!-- 保存的歌单将在这里显示 --&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- 播放器区域 --&gt;
  &lt;div class=&quot;player-section&quot; w-tid=&quot;137&quot;&gt;
    &lt;div class=&quot;current-song&quot; w-tid=&quot;139&quot;&gt;
      &lt;div class=&quot;current-cover-container&quot; w-tid=&quot;141&quot;&gt;
        &lt;img
          class=&quot;current-cover&quot;
          id=&quot;currentCover&quot;
          src=&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIwIiBoZWlnaHQ9IjIyMCIgdmlld0JveD0iMCAwIDIyMCAyMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMjAiIGhlaWdodD0iMjIwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSIyMCIvPgo8cGF0aCBkPSJNMTEwIDcwTDE0MCAxMTBIMTIwVjE1MEg5MFYxMTBINzBMMTEwIDcwWiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+Cjwvc3ZnPgo=&quot;
          alt=&quot;专辑封面&quot;
          w-tid=&quot;143&quot;
        /&gt;
      &lt;/div&gt;
      &lt;div class=&quot;current-info&quot; w-tid=&quot;145&quot;&gt;
        &lt;h3 id=&quot;currentTitle&quot; w-tid=&quot;147&quot;&gt;未选择歌曲&lt;/h3&gt;
        &lt;p id=&quot;currentArtist&quot; w-tid=&quot;149&quot;&gt;请搜索并选择要播放的歌曲&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 播放器歌词显示 --&gt;
    &lt;div
      class=&quot;player-lyrics-container&quot;
      id=&quot;playerLyricsContainer&quot;
      w-tid=&quot;151&quot;
    &gt;
      &lt;div
        class=&quot;lyrics-offset-display&quot;
        id=&quot;lyricsOffsetDisplay&quot;
        w-tid=&quot;153&quot;
      &gt;
        ±0.0
      &lt;/div&gt;
      &lt;div
        class=&quot;player-lyrics-wrapper&quot;
        id=&quot;playerLyricsWrapper&quot;
        w-tid=&quot;155&quot;
      &gt;
        &lt;div
          class=&quot;player-lyrics-list&quot;
          id=&quot;playerLyricsList&quot;
          w-tid=&quot;157&quot;
        &gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;lyrics-adjust-controls&quot; w-tid=&quot;159&quot;&gt;
      &lt;button
        class=&quot;lyrics-adjust-btn&quot;
        onclick=&quot;adjustLyrics(0.5)&quot;
        title=&quot;歌词延后0.5秒&quot;
        aria-label=&quot;歌词延后0.5秒&quot;
        w-tid=&quot;161&quot;
      &gt;
        ←
      &lt;/button&gt;
      &lt;button
        class=&quot;lyrics-adjust-btn&quot;
        onclick=&quot;resetLyricsOffset()&quot;
        title=&quot;重置歌词偏移&quot;
        aria-label=&quot;重置歌词偏移&quot;
        w-tid=&quot;163&quot;
      &gt;
        ↺
      &lt;/button&gt;
      &lt;button
        class=&quot;lyrics-adjust-btn&quot;
        onclick=&quot;adjustLyrics(-0.5)&quot;
        title=&quot;歌词提前0.5秒&quot;
        aria-label=&quot;歌词提前0.5秒&quot;
        w-tid=&quot;165&quot;
      &gt;
        →
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;player-controls&quot; w-tid=&quot;167&quot;&gt;
      &lt;button
        class=&quot;control-btn small&quot;
        onclick=&quot;previousSong()&quot;
        aria-label=&quot;上一首&quot;
        w-tid=&quot;169&quot;
      &gt;
        &lt;i class=&quot;fas fa-step-backward&quot; aria-hidden=&quot;true&quot; w-tid=&quot;171&quot;&gt;&lt;/i&gt;
      &lt;/button&gt;
      &lt;button
        class=&quot;control-btn play-btn&quot;
        id=&quot;playBtn&quot;
        onclick=&quot;togglePlay()&quot;
        aria-label=&quot;播放/暂停&quot;
        w-tid=&quot;173&quot;
      &gt;
        &lt;i class=&quot;fas fa-play&quot; aria-hidden=&quot;true&quot; w-tid=&quot;175&quot;&gt;&lt;/i&gt;
      &lt;/button&gt;
      &lt;button
        class=&quot;control-btn small&quot;
        onclick=&quot;nextSong()&quot;
        aria-label=&quot;下一首&quot;
        w-tid=&quot;177&quot;
      &gt;
        &lt;i class=&quot;fas fa-step-forward&quot; aria-hidden=&quot;true&quot; w-tid=&quot;179&quot;&gt;&lt;/i&gt;
      &lt;/button&gt;
    &lt;/div&gt;

    &lt;div class=&quot;progress-container&quot; w-tid=&quot;181&quot;&gt;
      &lt;div class=&quot;progress-bar&quot; onclick=&quot;seekTo(event)&quot; w-tid=&quot;183&quot;&gt;
        &lt;div class=&quot;progress-fill&quot; id=&quot;progressFill&quot; w-tid=&quot;185&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;time-info&quot; w-tid=&quot;187&quot;&gt;
        &lt;span id=&quot;currentTime&quot; w-tid=&quot;189&quot;&gt;0:00&lt;/span&gt;
        &lt;span id=&quot;totalTime&quot; w-tid=&quot;191&quot;&gt;0:00&lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 音质选择 --&gt;
    &lt;div class=&quot;quality-container&quot; w-tid=&quot;193&quot;&gt;
      &lt;div class=&quot;quality-label&quot; w-tid=&quot;195&quot;&gt;
        &lt;i class=&quot;fas fa-music&quot; w-tid=&quot;197&quot;&gt;&lt;/i&gt;
        &lt;span w-tid=&quot;199&quot;&gt;音质&lt;/span&gt;
      &lt;/div&gt;
      &lt;select class=&quot;quality-select&quot; id=&quot;qualitySelect&quot; w-tid=&quot;201&quot;&gt;
        &lt;option value=&quot;128&quot; w-tid=&quot;203&quot;&gt;标准 128K&lt;/option&gt;
        &lt;option value=&quot;192&quot; w-tid=&quot;205&quot;&gt;较高 192K&lt;/option&gt;
        &lt;option value=&quot;320&quot; selected w-tid=&quot;207&quot;&gt;高品质 320K&lt;/option&gt;
        &lt;option value=&quot;740&quot; w-tid=&quot;209&quot;&gt;无损 FLAC&lt;/option&gt;
        &lt;option value=&quot;999&quot; w-tid=&quot;211&quot;&gt;Hi-Res&lt;/option&gt;
      &lt;/select&gt;
    &lt;/div&gt;

    &lt;div class=&quot;volume-container&quot; w-tid=&quot;213&quot;&gt;
      &lt;i class=&quot;fas fa-volume-up volume-icon&quot; w-tid=&quot;215&quot;&gt;&lt;/i&gt;
      &lt;input
        type=&quot;range&quot;
        class=&quot;volume-slider&quot;
        id=&quot;volumeSlider&quot;
        min=&quot;0&quot;
        max=&quot;100&quot;
        value=&quot;80&quot;
        onchange=&quot;setVolume(this.value)&quot;
        w-tid=&quot;217&quot;
      /&gt;
    &lt;/div&gt;

    &lt;!-- 下载区域 --&gt;
    &lt;div class=&quot;download-container&quot; w-tid=&quot;219&quot;&gt;
      &lt;button
        class=&quot;download-btn&quot;
        onclick=&quot;downloadCurrentSong()&quot;
        id=&quot;downloadSongBtn&quot;
        disabled
        w-tid=&quot;221&quot;
      &gt;
        &lt;i class=&quot;fas fa-download&quot; w-tid=&quot;223&quot;&gt;&lt;/i&gt;
        &lt;span w-tid=&quot;225&quot;&gt;下载音乐&lt;/span&gt;
      &lt;/button&gt;
      &lt;button
        class=&quot;download-btn&quot;
        onclick=&quot;downloadCurrentLyric()&quot;
        id=&quot;downloadLyricBtn&quot;
        disabled
        w-tid=&quot;227&quot;
      &gt;
        &lt;i class=&quot;fas fa-file-text&quot; w-tid=&quot;229&quot;&gt;&lt;/i&gt;
        &lt;span w-tid=&quot;231&quot;&gt;下载歌词&lt;/span&gt;
      &lt;/button&gt;
    &lt;/div&gt;

    &lt;audio id=&quot;audioPlayer&quot; preload=&quot;metadata&quot; w-tid=&quot;233&quot;&gt;&lt;/audio&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;script w-tid=&quot;235&quot;&gt;
  const API_BASE = &quot;https://music-api.gdstudio.xyz/api.php&quot;;
  let currentPlaylist = [];
  let currentIndex = -1;
  let currentLyrics = [];
  let isPlaying = false;
  let savedPlaylists =
    JSON.parse(localStorage.getItem(&quot;savedPlaylists&quot;)) || [];

  const audioPlayer = document.getElementById(&quot;audioPlayer&quot;);
  const playBtn = document.getElementById(&quot;playBtn&quot;);
  const progressFill = document.getElementById(&quot;progressFill&quot;);
  const currentTimeSpan = document.getElementById(&quot;currentTime&quot;);
  const totalTimeSpan = document.getElementById(&quot;totalTime&quot;);
  const playerLyricsList = document.getElementById(&quot;playerLyricsList&quot;);
  const playerLyricsWrapper = document.getElementById(
    &quot;playerLyricsWrapper&quot;
  );
  const playerLyricsContainer = document.getElementById(
    &quot;playerLyricsContainer&quot;
  );
  const lyricsOffsetDisplay = document.getElementById(
    &quot;lyricsOffsetDisplay&quot;
  );
  const currentCover = document.getElementById(&quot;currentCover&quot;);

  // 歌词偏移量（用于手动校准）
  let lyricsOffset = 0;
  let currentSongId = null;

  // 歌词滚动相关变量
  let isLyricsScrolling = false;
  let lyricsScrollTimeout = null;
  let lastScrollTime = 0;

  // 搜索音乐
  async function searchMusic() {
    const keyword = document.getElementById(&quot;searchInput&quot;).value.trim();
    const source = document.getElementById(&quot;sourceSelect&quot;).value;

    if (!keyword) {
      showNotification(&quot;请输入搜索关键词&quot;, &quot;warning&quot;);
      return;
    }

    // 重置标题显示
    document.getElementById(&quot;resultsTitle&quot;).innerHTML = &quot;搜索结果&quot;;
    // 隐藏歌单标签
    const tagIndicator = document.querySelector(&quot;.playlist-tag-indicator&quot;);
    if (tagIndicator) {
      tagIndicator.style.display = &quot;none&quot;;
    }
    document.getElementById(&quot;clearPlaylistBtn&quot;).style.display = &quot;none&quot;;

    // 隐藏歌单详情区域
    document.getElementById(&quot;playlistDetail&quot;).style.display = &quot;none&quot;;

    const resultsContainer = document.getElementById(&quot;searchResults&quot;);
    resultsContainer.innerHTML = `
            &lt;div class=&quot;loading&quot;&gt;
                &lt;i class=&quot;fas fa-spinner&quot;&gt;&lt;/i&gt;
                &lt;div&gt;正在搜索音乐...&lt;/div&gt;
            &lt;/div&gt;
        `;

    try {
      const response = await fetch(
        `${API_BASE}?types=search&amp;source=${source}&amp;name=${encodeURIComponent(
          keyword
        )}&amp;count=30`
      );
      const data = await response.json();

      if (data &amp;&amp; data.length &gt; 0) {
        currentPlaylist = data;
        displaySearchResults(data);
      } else {
        resultsContainer.innerHTML = `
                    &lt;div class=&quot;error&quot;&gt;
                        &lt;i class=&quot;fas fa-exclamation-triangle&quot;&gt;&lt;/i&gt;
                        &lt;div&gt;未找到相关歌曲，请尝试其他关键词&lt;/div&gt;
                    &lt;/div&gt;
                `;
      }
    } catch (error) {
      console.error(&quot;搜索失败:&quot;, error);
      resultsContainer.innerHTML = `
                &lt;div class=&quot;error&quot;&gt;
                    &lt;i class=&quot;fas fa-wifi&quot;&gt;&lt;/i&gt;
                    &lt;div&gt;网络连接失败，请检查网络后重试&lt;/div&gt;
                &lt;/div&gt;
            `;
    }
  }

  // 获取专辑图片URL
  async function getAlbumCoverUrl(song, size = 300) {
    // 对于歌单中的歌曲，直接使用picUrl字段
    if (song.picUrl) {
      return song.picUrl;
    }

    // 对于搜索结果中的歌曲，使用原来的pic_id获取封面图片
    const picId = song.pic_id || song.id;

    if (!picId) {
      return &quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTUiIGhlaWdodD0iNTUiIHZpZXdCb3g9IjAgMCA1NSA1NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjU1IiBoZWlnaHQ9IjU1IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSI4Ii8+CjxwYXRoIGQ9Ik0yNy41IDE4TDM1IDI3LjVIMzBWMzdIMjVWMjcuNUgyMEwyNy41IDE4WiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+Cjwvc3ZnPgo=&quot;;
    }

    try {
      const response = await fetch(
        `${API_BASE}?types=pic&amp;source=${song.source}&amp;id=${picId}&amp;size=${size}`
      );
      const data = await response.json();

      if (data &amp;&amp; data.url) {
        return data.url;
      }
    } catch (error) {
      console.error(&quot;获取专辑图失败:&quot;, error);
    }

    return &quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTUiIGhlaWdodD0iNTUiIHZpZXdCb3g9IjAgMCA1NSA1NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjU1IiBoZWlnaHQ9IjU1IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSI4Ii8+CjxwYXRoIGQ9Ik0yNy41IDE4TDM1IDI3LjVIMzBWMzdIMjVWMjcuNUgyMEwyNy41IDE4WiIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+Cjwvc3ZnPgo=&quot;;
  }

  // 显示搜索结果
  async function displaySearchResults(songs) {
    const resultsContainer = document.getElementById(&quot;searchResults&quot;);
    resultsContainer.innerHTML = &quot;&quot;;

    for (let index = 0; index &lt; songs.length; index++) {
      const song = songs[index];
      const songItem = document.createElement(&quot;div&quot;);
      songItem.className = &quot;song-item&quot;;
      songItem.onclick = () =&gt; playSong(index);

      songItem.innerHTML = `
                &lt;div class=&quot;song-index&quot; aria-hidden=&quot;true&quot;&gt;${(index + 1)
                  .toString()
                  .padStart(2, &quot;0&quot;)}&lt;/div&gt;
                &lt;div class=&quot;song-info&quot;&gt;
                    &lt;div class=&quot;song-name&quot;&gt;${song.name}&lt;/div&gt;
                    &lt;div class=&quot;song-artist&quot;&gt;${
                      Array.isArray(song.artist)
                        ? song.artist.join(&quot; / &quot;)
                        : song.artist
                    } · ${song.album}&lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;song-actions&quot;&gt;
                    &lt;button class=&quot;action-btn&quot; onclick=&quot;downloadSong(${index})&quot; title=&quot;下载音乐&quot; aria-label=&quot;下载音乐 ${
        song.name
      }&quot;&gt;
                        &lt;i class=&quot;fas fa-download&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
                    &lt;/button&gt;
                    &lt;button class=&quot;action-btn&quot; onclick=&quot;downloadLyric(${index})&quot; title=&quot;下载歌词&quot; aria-label=&quot;下载歌词 ${
        song.name
      }&quot;&gt;
                        &lt;i class=&quot;fas fa-file-text&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
            `;

      resultsContainer.appendChild(songItem);
    }
  }

  // 播放歌曲
  async function playSong(index) {
    if (index &lt; 0 || index &gt;= currentPlaylist.length) return;

    currentIndex = index;
    const song = currentPlaylist[index];

    // 更新UI
    await updateCurrentSongInfo(song);
    updateActiveItem();

    // 重置歌词偏移量
    lyricsOffset = 0;
    currentSongId = song.id;

    try {
      showNotification(&quot;正在加载音乐...&quot;, &quot;info&quot;);

      // 获取当前选择的音质
      const quality = document.getElementById(&quot;qualitySelect&quot;).value;

      // 获取音乐URL
      const urlResponse = await fetch(
        `${API_BASE}?types=url&amp;source=${song.source}&amp;id=${song.id}&amp;br=${quality}`
      );
      const urlData = await urlResponse.json();

      if (urlData &amp;&amp; urlData.url) {
        audioPlayer.src = urlData.url;
        audioPlayer.load();

        // 获取歌词
        loadLyrics(song);

        // 启用下载按钮
        document.getElementById(&quot;downloadSongBtn&quot;).disabled = false;
        document.getElementById(&quot;downloadLyricBtn&quot;).disabled = false;

        // 自动播放
        const playPromise = audioPlayer.play();
        if (playPromise !== undefined) {
          playPromise
            .then(() =&gt; {
              isPlaying = true;
              updatePlayButton();
              currentCover.classList.add(&quot;playing&quot;);
              showNotification(
                `开始播放 (${getQualityText(urlData.br || quality)})`,
                &quot;success&quot;
              );
            })
            .catch((error) =&gt; {
              console.error(&quot;播放失败:&quot;, error);
              showNotification(&quot;播放失败，请尝试其他歌曲&quot;, &quot;error&quot;);
            });
        }
      } else {
        showNotification(
          &quot;无法获取音乐链接，请尝试其他歌曲或更换音质&quot;,
          &quot;error&quot;
        );
      }
    } catch (error) {
      console.error(&quot;播放失败:&quot;, error);
      showNotification(&quot;播放失败，请检查网络连接&quot;, &quot;error&quot;);
    }
  }

  // 获取音质文本
  function getQualityText(br) {
    const qualityMap = {
      128: &quot;标准音质&quot;,
      192: &quot;较高音质&quot;,
      320: &quot;高品质&quot;,
      740: &quot;无损音质&quot;,
      999: &quot;Hi-Res音质&quot;,
    };
    return qualityMap[br] || `${br}K`;
  }

  // 下载当前播放的歌曲
  async function downloadCurrentSong() {
    if (currentIndex === -1) {
      showNotification(&quot;请先选择要下载的歌曲&quot;, &quot;warning&quot;);
      return;
    }

    const song = currentPlaylist[currentIndex];
    await downloadSong(currentIndex);
  }

  // 下载当前播放的歌词
  async function downloadCurrentLyric() {
    if (currentIndex === -1) {
      showNotification(&quot;请先选择要下载歌词的歌曲&quot;, &quot;warning&quot;);
      return;
    }

    await downloadLyric(currentIndex);
  }

  // 下载歌曲
  async function downloadSong(index) {
    const song = currentPlaylist[index];
    const quality = document.getElementById(&quot;qualitySelect&quot;).value;

    try {
      showNotification(&quot;正在获取下载链接...&quot;, &quot;info&quot;);

      const response = await fetch(
        `${API_BASE}?types=url&amp;source=${song.source}&amp;id=${song.id}&amp;br=${quality}`
      );
      const data = await response.json();

      if (data &amp;&amp; data.url) {
        // 创建下载链接
        const link = document.createElement(&quot;a&quot;);
        link.href = data.url;
        link.download = `${song.name} - ${
          Array.isArray(song.artist) ? song.artist.join(&quot;, &quot;) : song.artist
        }.mp3`;
        link.target = &quot;_blank&quot;;

        // 触发下载
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification(&quot;开始下载音乐文件&quot;, &quot;success&quot;);
      } else {
        showNotification(&quot;无法获取下载链接&quot;, &quot;error&quot;);
      }
    } catch (error) {
      console.error(&quot;下载失败:&quot;, error);
      showNotification(&quot;下载失败，请稍后重试&quot;, &quot;error&quot;);
    }
  }

  // 下载歌词
  async function downloadLyric(index) {
    const song = currentPlaylist[index];

    try {
      showNotification(&quot;正在获取歌词...&quot;, &quot;info&quot;);

      const response = await fetch(
        `${API_BASE}?types=lyric&amp;source=${song.source}&amp;id=${
          song.lyric_id || song.id
        }`
      );
      const data = await response.json();

      if (data &amp;&amp; data.lyric) {
        // 创建歌词文件内容
        let lyricContent = `歌曲：${song.name}\n`;
        lyricContent += `歌手：${
          Array.isArray(song.artist) ? song.artist.join(&quot;, &quot;) : song.artist
        }\n`;
        lyricContent += `专辑：${song.album}\n`;
        lyricContent += `来源：${song.source}\n\n`;
        lyricContent += data.lyric;

        if (data.tlyric) {
          lyricContent += &quot;\n=== 翻译歌词 ===\n&quot;;
          lyricContent += data.tlyric;
        }

        // 创建Blob并下载
        const blob = new Blob([lyricContent], {
          type: &quot;text/plain;charset=utf-8&quot;,
        });
        const url = URL.createObjectURL(blob);

        const link = document.createElement(&quot;a&quot;);
        link.href = url;
        link.download = `${song.name} - ${
          Array.isArray(song.artist) ? song.artist.join(&quot;, &quot;) : song.artist
        }.lrc`;

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        URL.revokeObjectURL(url);
        showNotification(&quot;歌词下载完成&quot;, &quot;success&quot;);
      } else {
        showNotification(&quot;该歌曲暂无歌词&quot;, &quot;warning&quot;);
      }
    } catch (error) {
      console.error(&quot;下载歌词失败:&quot;, error);
      showNotification(&quot;下载歌词失败，请稍后重试&quot;, &quot;error&quot;);
    }
  }

  // 音质改变时重新加载当前歌曲
  document
    .getElementById(&quot;qualitySelect&quot;)
    .addEventListener(&quot;change&quot;, () =&gt; {
      if (currentIndex !== -1 &amp;&amp; audioPlayer.src) {
        const currentTime = audioPlayer.currentTime;
        const wasPlaying = isPlaying;

        playSong(currentIndex).then(() =&gt; {
          // 恢复播放位置
          audioPlayer.currentTime = currentTime;
          if (!wasPlaying) {
            audioPlayer.pause();
          }
        });
      }
    });

  // 更新当前歌曲信息
  async function updateCurrentSongInfo(song) {
    document.getElementById(&quot;currentTitle&quot;).textContent = song.name;
    document.getElementById(&quot;currentArtist&quot;).textContent = `${
      Array.isArray(song.artist) ? song.artist.join(&quot; / &quot;) : song.artist
    } · ${song.album}`;

    // 获取专辑图片URL
    const coverUrl = await getAlbumCoverUrl(song, 500);
    currentCover.src = coverUrl;
  }

  // 更新活跃项目
  function updateActiveItem() {
    document.querySelectorAll(&quot;.song-item&quot;).forEach((item, index) =&gt; {
      item.classList.toggle(&quot;active&quot;, index === currentIndex);
    });
  }

  // 更新播放按钮
  function updatePlayButton() {
    const icon = playBtn.querySelector(&quot;i&quot;);
    if (isPlaying) {
      icon.className = &quot;fas fa-pause&quot;;
    } else {
      icon.className = &quot;fas fa-play&quot;;
    }
  }

  // 加载歌词
  async function loadLyrics(song) {
    // 重置歌词偏移量
    lyricsOffset = 0;
    currentSongId = song.id;

    // 更新偏移量显示
    updateLyricsOffsetDisplay();

    try {
      const response = await fetch(
        `${API_BASE}?types=lyric&amp;source=${song.source}&amp;id=${
          song.lyric_id || song.id
        }`
      );
      const data = await response.json();

      if (data &amp;&amp; data.lyric) {
        parseLyrics(data.lyric);
      } else {
        displayPlayerLyrics([]);
        currentLyrics = [];
      }
    } catch (error) {
      console.error(&quot;获取歌词失败:&quot;, error);
      displayPlayerLyrics([]);
      currentLyrics = [];
    }
  }

  // 解析LRC歌词
  function parseLyrics(lrcText) {
    const lines = lrcText.split(&quot;\n&quot;);
    currentLyrics = [];

    lines.forEach((line) =&gt; {
      const match = line.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);
      if (match) {
        const minutes = parseInt(match[1]);
        const seconds = parseInt(match[2]);
        const milliseconds = parseInt(match[3].padEnd(3, &quot;0&quot;));
        const text = match[4].trim();

        if (text) {
          const time = minutes * 60 + seconds + milliseconds / 1000;
          currentLyrics.push({ time, text });
        }
      }
    });

    currentLyrics.sort((a, b) =&gt; a.time - b.time);
    displayPlayerLyrics(currentLyrics);

    // 初始化歌词滚动事件监听器
    initLyricsScrollListeners();
  }

  // 显示播放器区域的多行歌词
  function displayPlayerLyrics(lyrics) {
    playerLyricsList.innerHTML = &quot;&quot;;

    if (lyrics.length === 0) {
      playerLyricsList.innerHTML =
        &#39;&lt;div class=&quot;player-lyric-line empty&quot;&gt;暂无歌词&lt;/div&gt;&#39;;
      return;
    }

    // 创建歌词行
    for (let i = 0; i &lt; lyrics.length; i++) {
      const lyricLine = document.createElement(&quot;div&quot;);
      lyricLine.className = &quot;player-lyric-line&quot;;
      lyricLine.textContent = lyrics[i].text;
      lyricLine.dataset.time = lyrics[i].time;

      // 检查歌词长度，如果过长则添加long-text类
      if (lyrics[i].text.length &gt; 30) {
        lyricLine.classList.add(&quot;long-text&quot;);
      }

      playerLyricsList.appendChild(lyricLine);
    }
  }

  // 初始化歌词滚动事件监听器
  function initLyricsScrollListeners() {
    // 清除之前的事件监听器
    playerLyricsWrapper.removeEventListener(&quot;wheel&quot;, handleLyricsScroll);
    playerLyricsWrapper.removeEventListener(&quot;click&quot;, handleLyricClick);

    // 添加鼠标滚轮事件监听
    playerLyricsWrapper.addEventListener(&quot;wheel&quot;, handleLyricsScroll, {
      passive: false,
    });

    // 添加点击事件监听
    playerLyricsWrapper.addEventListener(&quot;click&quot;, handleLyricClick);
  }

  // 处理歌词滚动事件
  function handleLyricsScroll(e) {
    // 阻止默认的滚动行为
    e.preventDefault();

    // 根据滚轮方向滚动歌词容器
    playerLyricsWrapper.scrollTop += e.deltaY;

    // 标记正在滚动
    isLyricsScrolling = true;
    lastScrollTime = Date.now();

    // 清除之前的定时器
    if (lyricsScrollTimeout) {
      clearTimeout(lyricsScrollTimeout);
    }

    // 3秒后自动复位
    lyricsScrollTimeout = setTimeout(() =&gt; {
      isLyricsScrolling = false;
      resetLyricsPosition();
    }, 3000);
  }

  // 处理歌词点击事件
  function handleLyricClick(e) {
    // 查找被点击的歌词行
    let target = e.target;
    while (target &amp;&amp; !target.classList.contains(&quot;player-lyric-line&quot;)) {
      target = target.parentElement;
    }

    // 如果点击的是歌词行
    if (target &amp;&amp; target.classList.contains(&quot;player-lyric-line&quot;)) {
      // 获取歌词时间
      const time = parseFloat(target.dataset.time);

      // 如果有有效的时间数据
      if (!isNaN(time)) {
        // 设置播放器时间
        audioPlayer.currentTime = time;

        // 显示通知
        showNotification(`已跳转到 ${formatTime(time)}`, &quot;success&quot;);

        // 停止滚动复位定时器
        if (lyricsScrollTimeout) {
          clearTimeout(lyricsScrollTimeout);
        }

        // 重置滚动状态
        isLyricsScrolling = false;

        // 立即更新歌词高亮
        updateLyricHighlight();
      }
    }
  }

  // 重置歌词位置到当前播放位置
  function resetLyricsPosition() {
    if (currentLyrics.length === 0) return;

    const currentTime = audioPlayer.currentTime - lyricsOffset;
    let activeIndex = -1;

    // 找到当前应该高亮的歌词
    for (let i = 0; i &lt; currentLyrics.length; i++) {
      if (currentLyrics[i].time &lt;= currentTime) {
        activeIndex = i;
      } else {
        break;
      }
    }

    // 如果找到了当前歌词，滚动到该位置
    if (activeIndex &gt;= 0) {
      const lyricLines =
        playerLyricsList.querySelectorAll(&quot;.player-lyric-line&quot;);
      if (lyricLines[activeIndex]) {
        // 计算需要滚动的位置，使当前歌词居中显示
        const containerHeight = playerLyricsWrapper.clientHeight;
        const lineHeight = lyricLines[activeIndex].offsetHeight;
        const lineOffsetTop = lyricLines[activeIndex].offsetTop;

        // 计算理想的滚动位置（将当前歌词放在容器中间）
        const idealScrollTop =
          lineOffsetTop - containerHeight / 2 + lineHeight / 2;

        // 平滑滚动到理想位置
        playerLyricsWrapper.scrollTo({
          top: Math.max(0, idealScrollTop),
          behavior: &quot;smooth&quot;,
        });
      }
    }
  }

  // 更新歌词高亮
  function updateLyricHighlight() {
    // 如果没有歌词，直接返回
    if (currentLyrics.length === 0) return;

    const currentTime = audioPlayer.currentTime - lyricsOffset; // 应用偏移量
    let activeIndex = -1;

    // 找到当前应该高亮的歌词索引
    for (let i = 0; i &lt; currentLyrics.length; i++) {
      if (currentLyrics[i].time &lt;= currentTime) {
        activeIndex = i;
      } else {
        break;
      }
    }

    // 调试信息
    // console.log(&#39;当前时间:&#39;, currentTime, &#39;活动索引:&#39;, activeIndex);

    // 如果没有找到匹配的歌词（可能在第一句之前），不高亮任何歌词
    if (activeIndex === -1) {
      const lyricLines =
        playerLyricsList.querySelectorAll(&quot;.player-lyric-line&quot;);
      lyricLines.forEach((line) =&gt; {
        line.classList.remove(
          &quot;current&quot;,
          &quot;before-current&quot;,
          &quot;after-current&quot;,
          &quot;first&quot;,
          &quot;last&quot;
        );
      });
      return;
    }

    const lyricLines =
      playerLyricsList.querySelectorAll(&quot;.player-lyric-line&quot;);
    // 使用文档片段来减少重排重绘
    const linesToUpdate = [];

    lyricLines.forEach((line, index) =&gt; {
      let shouldUpdate = false;
      const classesToRemove = [];
      const classesToAdd = [];

      // 更新当前行
      if (index === activeIndex) {
        if (!line.classList.contains(&quot;current&quot;)) {
          classesToAdd.push(&quot;current&quot;);
          shouldUpdate = true;
        }
        [&quot;before-current&quot;, &quot;after-current&quot;, &quot;first&quot;, &quot;last&quot;].forEach(
          (cls) =&gt; {
            if (line.classList.contains(cls)) {
              classesToRemove.push(cls);
              shouldUpdate = true;
            }
          }
        );
      }
      // 更新前一行
      else if (index === activeIndex - 1) {
        if (!line.classList.contains(&quot;before-current&quot;)) {
          classesToAdd.push(&quot;before-current&quot;);
          shouldUpdate = true;
        }
        [&quot;current&quot;, &quot;after-current&quot;, &quot;first&quot;, &quot;last&quot;].forEach((cls) =&gt; {
          if (line.classList.contains(cls)) {
            classesToRemove.push(cls);
            shouldUpdate = true;
          }
        });
      }
      // 更新后一行
      else if (index === activeIndex + 1) {
        if (!line.classList.contains(&quot;after-current&quot;)) {
          classesToAdd.push(&quot;after-current&quot;);
          shouldUpdate = true;
        }
        [&quot;current&quot;, &quot;before-current&quot;, &quot;first&quot;, &quot;last&quot;].forEach((cls) =&gt; {
          if (line.classList.contains(cls)) {
            classesToRemove.push(cls);
            shouldUpdate = true;
          }
        });
      }
      // 更新其他行
      else {
        const hasUnwantedClasses =
          line.classList.contains(&quot;current&quot;) ||
          line.classList.contains(&quot;before-current&quot;) ||
          line.classList.contains(&quot;after-current&quot;) ||
          line.classList.contains(&quot;first&quot;) ||
          line.classList.contains(&quot;last&quot;);
        if (hasUnwantedClasses) {
          [
            &quot;current&quot;,
            &quot;before-current&quot;,
            &quot;after-current&quot;,
            &quot;first&quot;,
            &quot;last&quot;,
          ].forEach((cls) =&gt; {
            if (line.classList.contains(cls)) {
              classesToRemove.push(cls);
              shouldUpdate = true;
            }
          });
        }
      }

      if (shouldUpdate) {
        linesToUpdate.push({ line, classesToAdd, classesToRemove });
      }
    });

    // 批量更新DOM
    linesToUpdate.forEach(({ line, classesToAdd, classesToRemove }) =&gt; {
      classesToRemove.forEach((cls) =&gt; line.classList.remove(cls));
      classesToAdd.forEach((cls) =&gt; line.classList.add(cls));
    });

    // 只有在没有手动滚动时才自动滚动
    if (!isLyricsScrolling) {
      // 使用requestAnimationFrame优化滚动性能
      requestAnimationFrame(() =&gt; {
        scrollToActiveLyric(activeIndex);
      });
    }
  }

  // 滚动到当前活动歌词
  function scrollToActiveLyric(activeIndex) {
    if (currentLyrics.length === 0 || activeIndex &lt; 0) return;

    const lyricLines =
      playerLyricsList.querySelectorAll(&quot;.player-lyric-line&quot;);
    if (lyricLines[activeIndex]) {
      // 计算需要滚动的位置，使当前歌词居中显示
      const containerHeight = playerLyricsWrapper.clientHeight;
      const lineHeight = lyricLines[activeIndex].offsetHeight;
      const lineOffsetTop = lyricLines[activeIndex].offsetTop;

      // 计算理想的滚动位置（将当前歌词放在容器中间）
      const idealScrollTop =
        lineOffsetTop - containerHeight / 2 + lineHeight / 2;

      // 直接滚动到理想位置（不使用平滑滚动，以确保及时响应）
      playerLyricsWrapper.scrollTop = Math.max(0, idealScrollTop);

      // 调试信息
      // console.log(&#39;滚动到歌词:&#39;, lyricLines[activeIndex].textContent, &#39;位置:&#39;, idealScrollTop);
    }
  }

  // 更新播放器区域的多行歌词显示（保持原有的5行显示方式）
  function updatePlayerLyricsDisplay(activeIndex) {
    // 这个函数现在是滚动到活动歌词的别名
    scrollToActiveLyric(activeIndex);
  }

  // 调整歌词偏移量
  function adjustLyrics(offset) {
    lyricsOffset += offset;
    showNotification(
      `歌词${offset &gt; 0 ? &quot;延后&quot; : &quot;提前&quot;}${Math.abs(offset)}秒 (${
        lyricsOffset &gt; 0 ? &quot;+&quot; : &quot;&quot;
      }${lyricsOffset.toFixed(1)}秒)`,
      &quot;info&quot;
    );

    // 更新偏移量显示
    updateLyricsOffsetDisplay();

    // 立即更新歌词显示以反映偏移量变化
    updateLyricHighlight();
  }

  // 重置歌词偏移量
  function resetLyricsOffset() {
    lyricsOffset = 0;
    showNotification(&quot;歌词偏移已重置&quot;, &quot;success&quot;);

    // 更新偏移量显示
    updateLyricsOffsetDisplay();

    // 立即更新歌词显示以反映偏移量变化
    updateLyricHighlight();
  }

  // 更新歌词偏移量显示
  function updateLyricsOffsetDisplay() {
    if (lyricsOffsetDisplay) {
      lyricsOffsetDisplay.textContent = `${
        lyricsOffset &gt; 0 ? &quot;+&quot; : &quot;&quot;
      }${lyricsOffset.toFixed(1)}`;
      lyricsOffsetDisplay.style.opacity =
        Math.abs(lyricsOffset) &gt; 0.1 ? &quot;1&quot; : &quot;0&quot;;
    }
  }

  // 播放控制
  function togglePlay() {
    if (audioPlayer.src) {
      if (isPlaying) {
        audioPlayer.pause();
      } else {
        audioPlayer.play();
      }
    } else {
      showNotification(&quot;请先选择要播放的歌曲&quot;, &quot;warning&quot;);
    }
  }

  function previousSong() {
    if (currentIndex &gt; 0) {
      playSong(currentIndex - 1);
    } else {
      showNotification(&quot;已经是第一首歌曲&quot;, &quot;info&quot;);
    }
  }

  function nextSong() {
    if (currentIndex &lt; currentPlaylist.length - 1) {
      playSong(currentIndex + 1);
    } else {
      showNotification(&quot;已经是最后一首歌曲&quot;, &quot;info&quot;);
    }
  }

  // 进度控制
  function seekTo(event) {
    if (audioPlayer.duration) {
      const rect = event.target.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      audioPlayer.currentTime = percent * audioPlayer.duration;
    }
  }

  function setVolume(value) {
    audioPlayer.volume = value / 100;

    // 更新音量图标
    const volumeIcon = document.querySelector(&quot;.volume-icon&quot;);
    if (value == 0) {
      volumeIcon.className = &quot;fas fa-volume-mute volume-icon&quot;;
    } else if (value &lt; 50) {
      volumeIcon.className = &quot;fas fa-volume-down volume-icon&quot;;
    } else {
      volumeIcon.className = &quot;fas fa-volume-up volume-icon&quot;;
    }
  }

  // 格式化时间
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, &quot;0&quot;)}`;
  }

  // 通知系统
  function showNotification(message, type = &quot;info&quot;) {
    // 创建通知元素
    const notification = document.createElement(&quot;div&quot;);
    notification.style.cssText = `
            position: fixed;
            top: 100px;
            right: 30px;
            background: ${
              type === &quot;success&quot;
                ? &quot;rgba(76, 175, 80, 0.9)&quot;
                : type === &quot;error&quot;
                ? &quot;rgba(244, 67, 54, 0.9)&quot;
                : type === &quot;warning&quot;
                ? &quot;rgba(255, 152, 0, 0.9)&quot;
                : &quot;rgba(33, 150, 243, 0.9)&quot;
            };
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            font-size: 14px;
        `;
    notification.textContent = message;

    document.body.appendChild(notification);

    // 显示动画
    setTimeout(() =&gt; {
      notification.style.transform = &quot;translateX(0)&quot;;
    }, 100);

    // 自动隐藏
    setTimeout(() =&gt; {
      notification.style.transform = &quot;translateX(400px)&quot;;
      setTimeout(() =&gt; {
        document.body.removeChild(notification);
      }, 300);
    }, 3000);
  }

  // 音频事件监听
  audioPlayer.addEventListener(&quot;timeupdate&quot;, () =&gt; {
    if (audioPlayer.duration) {
      const percent =
        (audioPlayer.currentTime / audioPlayer.duration) * 100;
      progressFill.style.width = percent + &quot;%&quot;;
      currentTimeSpan.textContent = formatTime(audioPlayer.currentTime);
    }
    // 始终更新歌词高亮，即使没有duration
    updateLyricHighlight();
  });

  audioPlayer.addEventListener(&quot;loadedmetadata&quot;, () =&gt; {
    totalTimeSpan.textContent = formatTime(audioPlayer.duration);
  });

  audioPlayer.addEventListener(&quot;ended&quot;, () =&gt; {
    // 重置歌词偏移量
    lyricsOffset = 0;
    nextSong();
  });

  audioPlayer.addEventListener(&quot;play&quot;, () =&gt; {
    isPlaying = true;
    updatePlayButton();
    currentCover.classList.add(&quot;playing&quot;);
  });

  audioPlayer.addEventListener(&quot;pause&quot;, () =&gt; {
    isPlaying = false;
    updatePlayButton();
    currentCover.classList.remove(&quot;playing&quot;);
  });

  // 键盘快捷键
  document.addEventListener(&quot;keydown&quot;, (e) =&gt; {
    if (e.code === &quot;Space&quot; &amp;&amp; e.target.tagName !== &quot;INPUT&quot;) {
      e.preventDefault();
      togglePlay();
    } else if (e.code === &quot;ArrowLeft&quot; &amp;&amp; e.target.tagName !== &quot;INPUT&quot;) {
      e.preventDefault();
      previousSong();
    } else if (e.code === &quot;ArrowRight&quot; &amp;&amp; e.target.tagName !== &quot;INPUT&quot;) {
      e.preventDefault();
      nextSong();
    }
  });

  // 搜索框回车事件
  document
    .getElementById(&quot;searchInput&quot;)
    .addEventListener(&quot;keypress&quot;, (e) =&gt; {
      if (e.key === &quot;Enter&quot;) {
        searchMusic();
      }
    });

  // 歌单导入功能
  async function importPlaylist() {
    const playlistIdInput = document.getElementById(&quot;playlistIdInput&quot;);
    const playlistId = playlistIdInput.value.trim();

    if (!playlistId) {
      showNotification(&quot;请输入歌单ID或链接&quot;, &quot;warning&quot;);
      return;
    }

    // 提取歌单ID（支持完整链接）
    let id = playlistId;
    const match = playlistId.match(/playlist\?id=(\d+)/);
    if (match) {
      id = match[1];
    }

    // 检查是否已经保存了这个歌单
    if (savedPlaylists.some((p) =&gt; p.id === id)) {
      showNotification(&quot;该歌单已存在&quot;, &quot;warning&quot;);
      return;
    }

    try {
      showNotification(&quot;正在导入歌单...&quot;, &quot;info&quot;);

      // 获取歌单信息
      const response = await fetch(
        `${API_BASE}?types=playlist&amp;source=netease&amp;id=${id}`
      );
      const data = await response.json();

      if (data &amp;&amp; data.code === 200 &amp;&amp; data.playlist) {
        // 转换歌单数据结构以匹配播放器需要的格式
        const tracks = data.playlist.tracks.map((track) =&gt; ({
          id: track.id,
          name: track.name,
          artist: Array.isArray(track.ar)
            ? track.ar.map((a) =&gt; a.name)
            : [track.ar.name],
          album: track.al ? track.al.name : &quot;&quot;,
          picUrl: track.al ? track.al.picUrl : &quot;&quot;, // 使用picUrl获取封面
          lyric_id: track.id,
          source: &quot;netease&quot;,
        }));

        // 提取创建者信息
        const creator = data.playlist.creator
          ? {
              nickname: data.playlist.creator.nickname,
              avatarUrl: data.playlist.creator.avatarUrl,
            }
          : null;

        const playlist = {
          id: data.playlist.id,
          name: data.playlist.name,
          tracks: tracks,
          cover: data.playlist.coverImgUrl || &quot;&quot;,
          creator: creator,
          playCount: data.playlist.playCount || 0,
          description: data.playlist.description || &quot;&quot;,
          tags: data.playlist.tags || [],
          createTime: new Date().toISOString(),
        };

        // 保存到本地存储
        savedPlaylists.push(playlist);
        localStorage.setItem(
          &quot;savedPlaylists&quot;,
          JSON.stringify(savedPlaylists)
        );

        // 更新UI
        displaySavedPlaylists();

        // 不再显示导入成功的通知
        playlistIdInput.value = &quot;&quot;;
      } else {
        showNotification(&quot;无法获取歌单信息，请检查ID是否正确&quot;, &quot;error&quot;);
      }
    } catch (error) {
      console.error(&quot;导入歌单失败:&quot;, error);
      // 不再显示导入歌单失败的通知
    }
  }

  // 显示保存的歌单
  function displaySavedPlaylists() {
    const container = document.getElementById(&quot;savedPlaylists&quot;);
    container.innerHTML = &quot;&quot;;

    if (savedPlaylists.length === 0) {
      container.innerHTML =
        &#39;&lt;div class=&quot;empty-state&quot;&gt;&lt;div&gt;暂无保存的歌单&lt;/div&gt;&lt;/div&gt;&#39;;
      return;
    }

    savedPlaylists.forEach((playlist, index) =&gt; {
      const playlistItem = document.createElement(&quot;div&quot;);
      playlistItem.className = &quot;playlist-item&quot;;
      playlistItem.onclick = () =&gt; playPlaylist(index); // 点击整个歌单项也可以播放
      playlistItem.innerHTML = `
                &lt;div class=&quot;playlist-info&quot;&gt;
                    &lt;div class=&quot;playlist-name&quot;&gt;${playlist.name}&lt;/div&gt;
                    &lt;div class=&quot;playlist-count&quot;&gt;${playlist.tracks.length} 首歌曲&lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;playlist-actions&quot;&gt;
                    &lt;button class=&quot;playlist-action-btn&quot; onclick=&quot;playPlaylist(${index}); event.stopPropagation();&quot; title=&quot;播放歌单&quot;&gt;
                        &lt;i class=&quot;fas fa-play&quot;&gt;&lt;/i&gt;
                    &lt;/button&gt;
                    &lt;button class=&quot;playlist-action-btn&quot; onclick=&quot;removePlaylist(${index}); event.stopPropagation();&quot; title=&quot;删除歌单&quot;&gt;
                        &lt;i class=&quot;fas fa-trash&quot;&gt;&lt;/i&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
            `;
      container.appendChild(playlistItem);
    });
  }

  // 播放歌单
  function playPlaylist(index) {
    if (index &lt; 0 || index &gt;= savedPlaylists.length) return;

    const playlist = savedPlaylists[index];
    currentPlaylist = playlist.tracks;
    currentIndex = -1;

    // 更新标题显示
    document.getElementById(&quot;resultsTitle&quot;).innerHTML = playlist.name;
    // 显示歌单标签
    const tagIndicator = document.querySelector(&quot;.playlist-tag-indicator&quot;);
    if (tagIndicator) {
      tagIndicator.style.display = &quot;flex&quot;;
    }
    document.getElementById(&quot;clearPlaylistBtn&quot;).style.display = &quot;flex&quot;;

    // 显示歌单详情
    displayPlaylistDetail(playlist);

    // 显示在搜索结果区域
    displaySearchResults(playlist.tracks);

    // 添加虚框提示
    addPlaylistHint();
  }

  // 添加播放列表虚框提示
  function addPlaylistHint() {
    const resultsContainer = document.getElementById(&quot;searchResults&quot;);
    const hintElement = document.createElement(&quot;div&quot;);
    hintElement.className = &quot;playlist-hint&quot;;
    hintElement.innerHTML = `
            &lt;div style=&quot;text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.7); border: 2px dashed rgba(255, 255, 255, 0.3); border-radius: 10px; margin-bottom: 20px;&quot;&gt;
                &lt;i class=&quot;fas fa-info-circle&quot; style=&quot;font-size: 24px; margin-bottom: 10px;&quot;&gt;&lt;/i&gt;
                &lt;div&gt;已加载歌单&lt;br&gt;点击此处或选择下方歌曲开始播放&lt;/div&gt;
            &lt;/div&gt;
        `;

    // 将提示插入到结果容器的顶部
    if (resultsContainer.firstChild) {
      resultsContainer.insertBefore(
        hintElement,
        resultsContainer.firstChild
      );
    } else {
      resultsContainer.appendChild(hintElement);
    }

    // 5秒后自动移除提示
    setTimeout(() =&gt; {
      if (hintElement.parentNode) {
        hintElement.parentNode.removeChild(hintElement);
      }
    }, 5000);
  }

  // 显示歌单详情
  function displayPlaylistDetail(playlist) {
    // 显示歌单详情区域
    document.getElementById(&quot;playlistDetail&quot;).style.display = &quot;block&quot;;

    // 设置歌单封面
    document.getElementById(&quot;playlistCover&quot;).src =
      playlist.cover ||
      &quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSIxMCIvPgo8cGF0aCBkPSJNNTAgNDVMMTAwIDc1TDUwIDEwNVY0NVoiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4zKSIvPgo8L3N2Zz4=&quot;;

    // 设置歌单标题
    document.getElementById(&quot;playlistTitle&quot;).textContent = playlist.name;

    // 设置创建者信息（如果有）
    if (playlist.creator) {
      document.getElementById(&quot;creatorAvatar&quot;).src =
        playlist.creator.avatarUrl ||
        &quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSIyMCIvPgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjE1IiByPSI1IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMykiLz4KPHBhdGggZD0iTTEwIDI1QzEwIDI1IDE1IDM1IDIwIDM1QzI1IDM1IDMwIDI1IDMwIDI1IiBzdHJva2U9InJnYmEoMjU1LDI1NSwyNTUsMC4zKSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+&quot;;
      document.getElementById(&quot;creatorName&quot;).textContent =
        playlist.creator.nickname || &quot;未知创建者&quot;;
    } else {
      document.getElementById(&quot;creatorAvatar&quot;).src =
        &quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHJ4PSIyMCIvPgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjE1IiByPSI1IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMykiLz4KPHBhdGggZD0iTTEwIDI1QzEwIDI1IDE1IDM1IDIwIDM1QzI1IDM1IDMwIDI1IDMwIDI1IiBzdHJva2U9InJnYmEoMjU1LDI1NSwyNTUsMC4zKSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+&quot;;
      document.getElementById(&quot;creatorName&quot;).textContent = &quot;未知创建者&quot;;
    }

    // 设置播放次数和歌曲数量
    document.getElementById(&quot;playlistPlayCount&quot;).textContent = `播放: ${
      playlist.playCount || 0
    }次`;
    document.getElementById(
      &quot;playlistTrackCount&quot;
    ).textContent = `歌曲: ${playlist.tracks.length}首`;

    // 设置描述（如果有）
    const descriptionEl = document.getElementById(&quot;playlistDescription&quot;);
    if (playlist.description) {
      descriptionEl.textContent = playlist.description;
      descriptionEl.style.display = &quot;block&quot;;
    } else {
      descriptionEl.style.display = &quot;none&quot;;
    }

    // 设置标签（如果有）
    const tagsContainer = document.getElementById(&quot;playlistTags&quot;);
    tagsContainer.innerHTML = &quot;&quot;;
    if (playlist.tags &amp;&amp; playlist.tags.length &gt; 0) {
      playlist.tags.forEach((tag) =&gt; {
        const tagEl = document.createElement(&quot;span&quot;);
        tagEl.className = &quot;playlist-tag&quot;;
        tagEl.textContent = tag;
        tagsContainer.appendChild(tagEl);
      });
    }
  }

  // 清除歌单视图
  function clearPlaylistView() {
    // 重置标题显示
    document.getElementById(&quot;resultsTitle&quot;).innerHTML = &quot;搜索结果&quot;;
    // 隐藏歌单标签
    const tagIndicator = document.querySelector(&quot;.playlist-tag-indicator&quot;);
    if (tagIndicator) {
      tagIndicator.style.display = &quot;none&quot;;
    }
    document.getElementById(&quot;clearPlaylistBtn&quot;).style.display = &quot;none&quot;;

    // 隐藏歌单详情区域
    document.getElementById(&quot;playlistDetail&quot;).style.display = &quot;none&quot;;

    // 清空搜索结果
    const resultsContainer = document.getElementById(&quot;searchResults&quot;);
    resultsContainer.innerHTML = `
            &lt;div class=&quot;empty-state&quot;&gt;
                &lt;i class=&quot;fas fa-search&quot;&gt;&lt;/i&gt;
                &lt;div&gt;在上方搜索框输入关键词开始搜索音乐&lt;/div&gt;
            &lt;/div&gt;
        `;

    // 重置播放列表
    currentPlaylist = [];
    currentIndex = -1;
  }

  // 删除歌单
  function removePlaylist(index) {
    if (index &lt; 0 || index &gt;= savedPlaylists.length) return;

    const playlist = savedPlaylists[index];
    if (confirm(`确定要删除歌单 &quot;${playlist.name}&quot; 吗？`)) {
      savedPlaylists.splice(index, 1);
      localStorage.setItem(
        &quot;savedPlaylists&quot;,
        JSON.stringify(savedPlaylists)
      );
      displaySavedPlaylists();
      showNotification(&quot;歌单已删除&quot;, &quot;success&quot;);
    }
  }

  // 初始化
  setVolume(80);
  displaySavedPlaylists();

  // 页面加载完成后的欢迎信息
  window.addEventListener(&quot;load&quot;, () =&gt; {
    // 不再显示欢迎通知
  });
&lt;/script&gt;
</code></pre>
  </body>
</html>
